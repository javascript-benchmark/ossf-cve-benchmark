import * as fs from "fs";
import * as path from "path";
import * as bcvesFromCLI from "../bcves-from-cli";
import { Config, ToolID } from "../persistent-types";
import { writeExportFile } from "../util";

export default async (
  config: Config,
  args: {
    selectors: string[];
    tool: ToolID[];
    import?: string;
    no_export_file: boolean;
    no_sources: boolean;
    allow_incomplete: boolean;
    anonymize: boolean;
    non_fatal_validation_errors: boolean;
  }
) => {
  let bcves = await bcvesFromCLI.getBCVEsWithRuns(config, args, false);
  if (args.no_export_file) {
    console.log(JSON.stringify(bcves));
  } else {
    fs.mkdirSync(path.dirname(config.export), { recursive: true });
    writeExportFile(config.export, bcves, !args.non_fatal_validation_errors);
  }
};
