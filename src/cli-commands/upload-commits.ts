import * as bcvesFromCLI from "../bcves-from-cli";
import * as repositories from "../repositories";
import { Config } from "../persistent-types";

export default async (
  config: Config,
  args: {
    selectors: string[];
    allow_incomplete: boolean;
    auth_token: string;
    non_fatal_validation_errors: boolean;
  }
) => {
  await Promise.all(
    (await bcvesFromCLI.getBCVEs(config, args, true)).map(async bcve =>
      repositories.uploadCVECommitsToCanonicalRepository(
        bcve,
        config["canonical-repositories-root"],
        args.auth_token
      )
    )
  );
};
