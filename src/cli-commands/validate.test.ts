import validate from "./validate";
import * as path from "path";
import { getProjectRoot } from "../util";
describe("cli-command: validate", () => {
  describe("Error cases", () => {
    test("Throws on empty files", () => {
      expect.assertions(1);
      expect(
        validate(undefined, {
          schema: "BCVE",
          files: []
        })
      ).rejects.toBeTruthy();
    });

    test("Throws on bad schema name", () => {
      expect.assertions(1);
      expect(
        validate(undefined, {
          schema: "NOT_BCVE" as any,
          files: []
        })
      ).rejects.toBeTruthy();
    });
  });

  describe("Ordinary cases", () => {
    beforeEach(() => {
      console.log = jest.fn();
      expect.assertions(1);
    });
    test("Can validate all CVEs", async () =>
      await validate(undefined, {
        schema: "BCVE",
        // TODO use mock test data instead
        files: [path.join(getProjectRoot(), "CVEs")]
      }));
    afterEach(() => expect(console.log).toBeCalled());
  });
});
